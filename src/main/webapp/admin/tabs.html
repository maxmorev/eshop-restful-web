<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <title>Title</title>
    <meta charset="utf-8">

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">-->
    <link rel="stylesheet" href="../mdl/material.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

</head>
<body>

<script>

var URL_SERVICES = "http://localhost:8888";

function deleteType(typeId){

    var snackbarContainer = document.querySelector('#demo-toast-example');

    $.getJSON(URL_SERVICES + "/deleteType/?id=" + typeId, function(json, status){

        refreshTypes();
        var toastMessage = {message: 'Success' };
        snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);


	 })
	 .fail(function(json, status) {
        var toastMessage = {message: 'Error' };
        snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);
	 });

};

function refreshTypes(){

     var typeContainer = document.querySelector('#container-types');

     $.getJSON(URL_SERVICES + "/commodityTypes/", function(json, status){

        var content = "";
        for(var i=0; i<json.length; i++){

            content += "<tr>";
            content += "<td class='mdl-data-table__cell--non-numeric'>" + json[i].id + "</td>";
            content += "<td>" + "<a class='edit-commodityType-link' href='#typeId/" + json[i].id + "' onclick='onEditTypeClick("+json[i].id+");'>" +json[i].name + "</td>";
            content += "<td>NAN</td>";
            content += "<td><button class='mdl-button mdl-js-button mdl-button--icon mdl-button--colored' onclick='deleteType(" + json[i].id + ");'><i class='material-icons'>delete</i></button></td>";
            content += "</tr>";

        }
        $('#container-types').empty();
        $('#container-types').append(content);


	 })
	 .fail(function(json, status) {
	  		//$("#status").text(status);
	 });


};

function deletePropertyValue(valueId){

    var snackbarContainer = document.querySelector('#demo-toast-example');

    $.getJSON(URL_SERVICES + "/deletePropertyValue/?id=" + valueId, function(json, status){
        var typeId = getTypeIdFromUrl();
        refreshProperties(typeId);
        var toastMessage = {message: 'Delete Property Value Success ' + json.status };
        snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);

	 })
	 .fail(function(json, status) {
        var toastMessage = {message: 'Error in Delete Property Value ' +  + json.status };
        snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);
	 });

};

function refreshProperties(typeId){
     var snackbarContainer = document.querySelector('#demo-toast-example');

     var propertiesURL = "/commodityProperties/?typeId=" + typeId;

     var toastMessage = {message: "refreshProperties: " + propertiesURL };
     //snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);


     $.getJSON( URL_SERVICES + propertiesURL, function(json, status){

        var content = "";
        for(var i=0; i<json.length; i++){
            if(json[i].values){
                for(var valIndex=0; valIndex < json[i].values.length; valIndex++){
                    content += "<tr>";
                    content += "<td class='mdl-data-table__cell--non-numeric'>" + json[i].name + "</td>";
                    content += "<td>" + json[i].values[valIndex].value + "</td>";
                    content += "<td><button class='mdl-button mdl-js-button mdl-button--icon mdl-button--colored' onclick='deletePropertyValue(" + json[i].values[valIndex].id + ");'><i class='material-icons'>delete</i></button></td>";
                    content += "</tr>";
                }
            }

        }
        $('#container-attributes').empty();
        $('#container-attributes').append(content);


	 })
	 .fail(function(json, status) {
	    $('#container-attributes').empty();
	    toastMessage = {message: "Error on load attributes." };
        snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);

	 });


};

function getCommodityType(typeId){

    var snackbarContainer = document.querySelector('#demo-toast-example');

    $.getJSON( URL_SERVICES + "/commodityType/?id="+typeId, function(json, status){

        //FIX set onFocus smthing at elements

        $('#commodityTypeNameEdit').val( json.name );
        $('#commodityTypeDescEdit').val( json.description );

	 })
	 .fail(function(json, status) {
        var toastMessage = {message: 'Error: ' + json.message };
        snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);
	 });

};


function onEditTypeClick(typeId) {
        var snackbarContainer = document.querySelector('#demo-toast-example');
        //var currentURL = btn.getAttribute("href");
        //var splited = currentURL.split("#");
        var toastMessage = {message: 'Hide -> typeId= ' + typeId };
        snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);
        if( typeId ){
            //var params = splited[1].split("/");
            //get commodityType -> set params
            //currentTypeId = typeId;
            showEditType();
            getCommodityType(typeId);
            refreshProperties(typeId);

        }
};


  function showEditType(){
    $('#error-message').hide();
    $("#form-create").hide();
    $("#form-edit-commodityType").show();
    $("#commodityType-list").hide();
    $("#commodityType-attributes").show();


  };

  function cleanCreateType(){
    $( "#commodityTypeName" ).val("");
    $( "#commodityTypeDesc" ).val("");
  };

  function cleanProperty(){
    $( "#propertyName" ).val("");
    $( "#attributeValue" ).val("");
  };

  function showCreateType(){

    cleanCreateType();
    refreshTypes();
    $('#error-message').hide();
    $("#form-create").show();
    $("#form-edit-commodityType").hide();
    $("#commodityType-list").show();
    $("#commodityType-attributes").hide();

  };


  function showForm(){
    var currentURL = window.location.href;
    var splited = currentURL.split("#");


    if( splited.length==1 ){

        showCreateType();

    }else{
        if( splited.length>1 && splited[1].includes("typeId") ){
            var typeId = getTypeIdFromUrl();
            cleanProperty();
            getCommodityType(typeId);
            refreshProperties(typeId);
            showEditType();
        }else{
            showCreateType();
        }
    }
  };

  function getTypeIdFromUrl(){
    var currentURL = window.location.href;
    var splited = currentURL.split("#");

    if( splited.length==1 ){
        return null;
    }else{
        if( splited.length>1 && splited[1].includes("typeId") ){
            var typeIdPara = splited[1].split("/");
            return typeIdPara[1];
        }else{
            return null;
        }
    }

  };


  function showError(json){

    var message = "<b>" + json.responseJSON.status +"</b>:&nbsp;" + json.responseJSON.message;
    $('#error-message-content').empty();
    $('#error-message-content').append(message);
    $('#error-message-content').show();
    $('#error-message').show();

  }


$(document).ready(function () {

  showForm();

  var snackbarContainer = document.querySelector('#demo-toast-example');
  var showToastButton = document.querySelector('#btn-createtype');

  showToastButton.addEventListener('click', function() {
    //'use strict';
    var data = {
        name: $( "#commodityTypeName" ).val(),
        description: $( "#commodityTypeDesc" ).val()
     };
     var options = {
                url: "/createType/",
                commodityType: 'post',
                dataType: 'json',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(data), // Our valid JSON string

                success: function( data, status, xhr ) {
                    //...

                    var toastMessage = {message: 'Success' };
                    snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);
                    refreshTypes();
                    cleanCreateType()
               },
               error: function( xhr, status, error ) {
                    //...
                    var toastMessage = {message: 'Error' };
                    snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);
                    refreshTypes();
                    cleanCreateType()
               }
    };
    $.ajax( options );
  });

  var createPropertyButton = document.querySelector('#btn-create-attribute');

  createPropertyButton.addEventListener('click', function() {
    var typeId = getTypeIdFromUrl();
    var data = {
        typeId: typeId,
        name: $( "#propertyName" ).val(),
        value: $( "#attributeValue" ).val()
    };

    var options = {
                url: "/createProperty/",
                commodityType: 'post',
                dataType: 'json',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(data), // Our valid JSON string

                success: function( data, status, xhr ) {

                    refreshProperties(typeId);
                    cleanProperty();
                    var toastMessage = {message: 'Adding attribute Success' };
                    snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);

               },
               error: function( xhr, status, error ) {
                    //...
                    var toastMessage = {message: 'Error ' + xhr.message };
                    snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);
                    cleanProperty();
                    //refreshTypes();
                    //cleanCreateType()
               }
    };
    $.ajax( options );

  });


  var btnPropertyBack = document.querySelector('#btn-attribute-back');
  btnPropertyBack.addEventListener('click', function() {
    window.location = '#commodityTypes';
    showCreateType();
  });

  var btnEditType = document.querySelector('#btn-edit-commodityType');
  btnEditType.addEventListener('click', function() {
    var typeId = getTypeIdFromUrl();
    var data = {
        id: typeId,
        name: $( "#commodityTypeNameEdit" ).val(),
        description: $( "#commodityTypeDescEdit" ).val()
     };
     var options = {
                url: "/updateType/",
                commodityType: 'post',
                dataType: 'json',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(data), // Our valid JSON string

                success: function( data, status, xhr ) {
                    //...
                    getCommodityType( typeId );
                    var toastMessage = {message: 'Success ' + data.status };
                    snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);


               },
               error: function( json, status ) {
                    //error handling
                    showError(json);
                    var toastMessage = { message: 'Error'  };
                    snackbarContainer.MaterialSnackbar.showSnackbar(toastMessage);

               }
    };
    $.ajax( options );

  });



});



</script>
<!-- Simple header with fixed tabs. -->
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header
            mdl-layout--fixed-tabs">
    <header class="mdl-layout__header">
        <div class="mdl-layout__header-row">
            <!-- Title -->
            <span class="mdl-layout-title">Title</span>
        </div>
        <!-- Tabs -->
        <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
            <a href="#fixed-tab-1" class="mdl-layout__tab is-active">Tab 1</a>
            <a href="#fixed-tab-2" class="mdl-layout__tab">Tab 2</a>
            <a href="#fixed-tab-3" class="mdl-layout__tab">Tab 3</a>
        </div>
    </header>
    <div class="mdl-layout__drawer">
        <span class="mdl-layout-title">Title</span>
    </div>
    <main class="mdl-layout__content">
        <section class="mdl-layout__tab-panel is-active" id="fixed-tab-1">
            <div class="page-content">

                <!-- Your content goes here -->

                <div class="mdl-grid">
                    <!-- left form -->
                    <div class="mdl-cell mdl-cell--6-col mdl-cell--8-col-tablet">
                        <!-- form create commodityType -->

                        <!-- Basic Chip for errors -->
                        <span class="mdl-chip" id="error-message">
                        <span class="mdl-chip__text" id="error-message-content"></span>
                        </span>

                        <div id="form-create">
                            <form  action="#">

                                <div class="mdl-grid">
                                    <div class="mdl-cell mdl-cell--6-col mdl-cell--8-col-tablet">
                                        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                            <input class="mdl-textfield__input" commodityType="text" id="commodityTypeName">
                                            <label class="mdl-textfield__label" for="commodityTypeName">Commodity Type Name...</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="mdl-grid">
                                    <div class="mdl-cell mdl-cell--6-col mdl-cell--8-col-tablet">
                                        <div class="mdl-textfield mdl-js-textfield">
                                            <textarea class="mdl-textfield__input" commodityType="text" rows= "3" id="commodityTypeDesc" ></textarea>
                                            <label class="mdl-textfield__label" for="commodityTypeDesc">Description...</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="mdl-grid">
                                    <!-- Accent-colored raised button with ripple -->
                                    <button id="btn-createtype" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent"  commodityType="button">
                                        Create commodityType
                                    </button>

                                </div>

                            </form>
                        </div>
                        <!-- end: form create commodityType -->
                        <!-- form edit commodityType -->
                        <div id="form-edit-commodityType">
                            <form  action="#">

                                <div class="mdl-grid">
                                    <div class="mdl-cell mdl-cell--6-col mdl-cell--8-col-tablet">
                                        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label is-upgraded is-dirty" data-upgraded=",MaterialTextfield">
                                            <input class="mdl-textfield__input" commodityType="text" id="commodityTypeNameEdit">
                                            <label class="mdl-textfield__label" for="commodityTypeNameEdit">Commodity Type Name...</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="mdl-grid">
                                    <div class="mdl-cell mdl-cell--6-col mdl-cell--8-col-tablet">
                                        <div class="mdl-textfield mdl-js-textfield  is-upgraded is-dirty" data-upgraded=",MaterialTextfield">
                                            <textarea class="mdl-textfield__input" commodityType="text" rows= "3" id="commodityTypeDescEdit" ></textarea>
                                            <label class="mdl-textfield__label" for="commodityTypeDescEdit">Description...</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="mdl-grid">
                                    <!-- Accent-colored raised button with ripple -->
                                    <button id="btn-edit-commodityType" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent"  commodityType="button">
                                        Edit commodityType
                                    </button>
                                </div>

                            </form>
                        </div>
                        <!-- end form edit commodityType -->
                        <!-- Toast place -->

                        <div id="demo-toast-example" class="mdl-js-snackbar mdl-snackbar">
                            <div class="mdl-snackbar__text"></div>
                            <button class="mdl-snackbar__action" commodityType="button"></button>
                        </div>

                        <!-- end Toast place -->
                    </div>

                    <!-- right content -->
                    <div class="mdl-cell mdl-cell--4-col mdl-cell--6-col-tablet">

                        <!-- commodityType list -->
                        <div id="commodityType-list">

                            <table  class="mdl-data-table mdl-js-data-table">
                                <thead>
                                <tr>
                                    <th class="mdl-data-table__cell--non-numeric">id</th>
                                    <th>Name</th>
                                    <th>Commodity quantity</th>
                                    <th>Delete</th>
                                </tr>
                                </thead>
                                <tbody id="container-types">


                                </tbody>
                            </table>
                        </div>
                        <!-- // end commodityType list -->

                        <!-- attributes -->
                        <div id="commodityType-attributes">
                            <!-- Mini FAB button -->
                            <button id="btn-attribute-back" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab">
                                <i class="material-icons">arrow_back</i>
                            </button>
                            <div ><h6>Create attributes of you commodity commodityType</h6>
                                Example:<br/> The wear's attribute name is <b>Size</b> and attribute value for <b>Size</b> is <b>S</b>
                            </div>
                            <div class="mdl-grid">
                                <div class="mdl-cell mdl-cell--4-col">

                                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                        <input class="mdl-textfield__input" commodityType="text" id="propertyName">
                                        <label class="mdl-textfield__label" for="propertyName">Name...</label>
                                    </div>

                                </div>
                                <div class="mdl-cell mdl-cell--4-col">
                                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                        <input class="mdl-textfield__input" commodityType="text" id="attributeValue">
                                        <label class="mdl-textfield__label" for="attributeValue">Value...</label>
                                    </div>

                                </div>
                                <div class="mdl-cell mdl-cell--1-col">
                                    <!-- Colored FAB button with ripple -->
                                    <button id="btn-create-attribute" class="mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored">
                                        <i class="material-icons">add</i>
                                    </button>
                                </div>
                            </div>
                            <table  class="mdl-data-table mdl-js-data-table">
                                <thead>
                                <tr>
                                    <th class="mdl-data-table__cell--non-numeric">Property Name</th>
                                    <th class="mdl-data-table__cell--non-numeric">Property Value</th>
                                    <th class="mdl-data-table__cell--non-numeric">Delete</th>
                                </tr>
                                </thead>
                                <tbody id="container-attributes">
                                <td class="mdl-data-table__cell--non-numeric">size</td>
                                <td class="mdl-data-table__cell--non-numeric">S</td>
                                <td class="mdl-data-table__cell--non-numeric">
                                    DELETE
                                </td>

                                </tbody>
                            </table>

                        </div>
                        <!-- // attributes -->

                    </div>

                </div>



            </div>




        </section>
        <section class="mdl-layout__tab-panel" id="fixed-tab-2">
            <div class="page-content">Content 2</div>
        </section>
        <section class="mdl-layout__tab-panel" id="fixed-tab-3">
            <div class="page-content"><!-- Your content goes here --></div>
        </section>
    </main>
</div>


</body>
</html>